<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.d48560e6ff0a9b23efe7.css">code[class*=language-],pre[class*=language-]{color:#c5c8c6;text-shadow:0 1px rgba(0,0,0,.3);font-family:Inconsolata,Monaco,Consolas,Courier New,Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#1d1f21}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#7c7c7c}.token.punctuation{color:#c5c8c6}.namespace{opacity:.7}.token.keyword,.token.property,.token.tag{color:#96cbfe}.token.class-name{color:#ffffb6;text-decoration:underline}.token.boolean,.token.constant{color:#9c9}.token.deleted,.token.symbol{color:#f92672}.token.number{color:#ff73fd}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a8ff60}.token.variable{color:#c6c5fe}.token.operator{color:#ededed}.token.entity{color:#ffffb6;cursor:help}.token.url{color:#96cbfe}.language-css .token.string,.style .token.string{color:#87c38a}.token.atrule,.token.attr-value{color:#f9ee98}.token.function{color:#dad085}.token.regex{color:#e9c062}.token.important{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:200;src:local("Nunito Extra Light "),local("Nunito-Extra Light"),url(/static/nunito-latin-200-2dbeb8d854e77c952cb636cb14a151c4.woff2) format("woff2"),url(/static/nunito-latin-200-e53a21a8bf1b97fb9900e8d5c5bfbc14.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:200;src:local("Nunito Extra Light italic"),local("Nunito-Extra Lightitalic"),url(/static/nunito-latin-200italic-bbdf1c37c56e1bfaf618b9a4ee46d508.woff2) format("woff2"),url(/static/nunito-latin-200italic-2bcb70df023a72cb0a5864c993d03bfc.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:300;src:local("Nunito Light "),local("Nunito-Light"),url(/static/nunito-latin-300-98aabf9aea1a55e2390109ad1efddce3.woff2) format("woff2"),url(/static/nunito-latin-300-97e0d2fc0422400a6e7be8f1b5e4949e.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:300;src:local("Nunito Light italic"),local("Nunito-Lightitalic"),url(/static/nunito-latin-300italic-ac71e7f9cd408dd512f6a6bbbd64eb51.woff2) format("woff2"),url(/static/nunito-latin-300italic-8646bd832f738c016b56b146af6fcd46.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:400;src:local("Nunito Regular "),local("Nunito-Regular"),url(/static/nunito-latin-400-508e414e3d3bc41666826fee46c7d881.woff2) format("woff2"),url(/static/nunito-latin-400-e5875b853d135f2a82ceae7ac537b6f4.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:400;src:local("Nunito Regular italic"),local("Nunito-Regularitalic"),url(/static/nunito-latin-400italic-28f555d9a5c83842f03988ed14f00ef5.woff2) format("woff2"),url(/static/nunito-latin-400italic-09ce3100c075ee04f293b9191c88f156.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:600;src:local("Nunito SemiBold "),local("Nunito-SemiBold"),url(/static/nunito-latin-600-8b8871e482a76d7e9327b02131564af7.woff2) format("woff2"),url(/static/nunito-latin-600-f894e279899f0cda9d06e32b78783399.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:600;src:local("Nunito SemiBold italic"),local("Nunito-SemiBolditalic"),url(/static/nunito-latin-600italic-9f930640316b0b9e8b088958d8f7aa5c.woff2) format("woff2"),url(/static/nunito-latin-600italic-9d150271cf30aefb8609dff4c9ece978.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:700;src:local("Nunito Bold "),local("Nunito-Bold"),url(/static/nunito-latin-700-a22acb48f45d03d672bf5b9389363a83.woff2) format("woff2"),url(/static/nunito-latin-700-7d90308f9bdf7321be5e28d017a5ade5.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:700;src:local("Nunito Bold italic"),local("Nunito-Bolditalic"),url(/static/nunito-latin-700italic-4507a1361620a66827e217855c9fff24.woff2) format("woff2"),url(/static/nunito-latin-700italic-26556875512fee1b823bc6117c076358.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:800;src:local("Nunito ExtraBold "),local("Nunito-ExtraBold"),url(/static/nunito-latin-800-eaa946756e91563b4b7d766de2f5b7ed.woff2) format("woff2"),url(/static/nunito-latin-800-5fa815a069b40c78f26863eaabcd6d2f.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:800;src:local("Nunito ExtraBold italic"),local("Nunito-ExtraBolditalic"),url(/static/nunito-latin-800italic-b9cd56a25c86d089cc18bc92dbad167a.woff2) format("woff2"),url(/static/nunito-latin-800italic-2e1a4979ec23066532d157ab5fe4ccc5.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:900;src:local("Nunito Black "),local("Nunito-Black"),url(/static/nunito-latin-900-f82c6fb49774f4e4caa570640e164320.woff2) format("woff2"),url(/static/nunito-latin-900-19de37363cebfe020de6d4abdbb38c2e.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:900;src:local("Nunito Black italic"),local("Nunito-Blackitalic"),url(/static/nunito-latin-900italic-6f10930c04eec040ac4ffb4890191149.woff2) format("woff2"),url(/static/nunito-latin-900italic-ca56cb53793f0f9084f26315012cefd8.woff) format("woff")}code{background-color:rgba(0,0,0,.04)}body{margin:0;font-family:Nunito,Avenir,Helvetica,"sans-serif";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{font-style:normal;color:rgba(0,0,0,.8);-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.8rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.8rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}a::selection,h1::selection,h2::selection,h3::selection,h4::selection,h5::selection,h6::selection,p::selection{background:rgba(255,250,150,.8)}.gatsby-highlight{background-color:#1d1f21;border-radius:.3em;margin:.5em 0;padding:1em;overflow:auto}.gatsby-highlight pre[class*=language-].line-numbers{padding:0 0 0 2.8em;overflow:initial}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 2.21.33"/><title data-react-helmet="true">Learning RabbitMQ | Ryan Ermita</title><meta data-react-helmet="true" name="description" content="We are on the process on converting our software architecture to Microservices and one way to communicate on each of these microservices is by using a message…"/><meta data-react-helmet="true" property="og:title" content="Learning RabbitMQ"/><meta data-react-helmet="true" property="og:description" content="We are on the process on converting our software architecture to Microservices and one way to communicate on each of these microservices is by using a message…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@ryanermita"/><meta data-react-helmet="true" name="twitter:title" content="Learning RabbitMQ"/><meta data-react-helmet="true" name="twitter:description" content="We are on the process on converting our software architecture to Microservices and one way to communicate on each of these microservices is by using a message…"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><link as="script" rel="preload" href="/webpack-runtime-e2098a117b0273a4ae10.js"/><link as="script" rel="preload" href="/framework-548c46c822ff9b8dc8b7.js"/><link as="script" rel="preload" href="/app-66cb945683d4e63ab9bd.js"/><link as="script" rel="preload" href="/styles-befd5c688c712b9481d4.js"/><link as="script" rel="preload" href="/commons-4671f1335672facc668e.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-b8dd6c499f6a6988d5db.js"/><link as="fetch" rel="preload" href="/page-data/software-engineering-journal/learning-rabbitmq/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1pyi7sa">.css-1pyi7sa{background:transparent;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><header class="css-1pyi7sa e2i1wbd3"><style data-emotion-css="k1grrt">.css-k1grrt{max-width:860px;padding:1rem 1.0875rem;font-size:1.2rem;}</style><div class="css-k1grrt e2i1wbd0"><p><style data-emotion-css="1kljdew">.css-1kljdew{color:black;margin-left:15px;-webkit-text-decoration:none;text-decoration:none;display:inline-block;position:relative;margin-left:0;}.css-1kljdew::after{content:"";position:absolute;width:100%;-webkit-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);height:2px;bottom:0;left:0;background-color:rgba(0,0,0,0.8);-webkit-transform-origin:bottom right;-ms-transform-origin:bottom right;transform-origin:bottom right;-webkit-transition:-webkit-transform 0.4s cubic-bezier(0.86,0,0.07,1);-webkit-transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);}.css-1kljdew:hover::after{-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:bottom left;-ms-transform-origin:bottom left;transform-origin:bottom left;}</style><a class="css-1kljdew e2i1wbd2" href="/">Ryan Ermita</a><style data-emotion-css="1wj6arw">.css-1wj6arw{color:black;margin-left:15px;-webkit-text-decoration:none;text-decoration:none;display:inline-block;position:relative;}.css-1wj6arw::after{content:"";position:absolute;width:100%;-webkit-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);height:2px;bottom:0;left:0;background-color:rgba(0,0,0,0.8);-webkit-transform-origin:bottom right;-ms-transform-origin:bottom right;transform-origin:bottom right;-webkit-transition:-webkit-transform 0.4s cubic-bezier(0.86,0,0.07,1);-webkit-transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);}.css-1wj6arw:hover::after{-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:bottom left;-ms-transform-origin:bottom left;transform-origin:bottom left;}</style><a class="css-1wj6arw e2i1wbd1" href="/software-engineering-journal">Software Engineering Journal</a></p></div></header><style data-emotion-css="1813l62">.css-1813l62{margin:0 auto;max-width:860px;padding:0 1.0875rem 1rem;padding-top:0;}</style><div class="css-1813l62 e1ehxxwc0"><main><style data-emotion-css="hu0znc">.css-hu0znc{margin:0 auto;max-width:860px;padding:1.45rem 1.0875rem;}</style><div class="css-hu0znc e1v73u8h0"><style data-emotion-css="1q2z4uj">.css-1q2z4uj{display:inline;border-radius:1em 0 1em 0;}</style><h1 class="css-1q2z4uj e1v73u8h1">Learning RabbitMQ</h1><style data-emotion-css="wvcn4j">.css-wvcn4j{margin-top:10px;color:#606060;}</style><h3 class="css-wvcn4j e1v73u8h2">July 26 , 2019<!-- --> - <!-- -->13 min read</h3><style data-emotion-css="157c1zx">.css-157c1zx a{-webkit-text-decoration:none;text-decoration:none;position:relative;background-image:linear-gradient( rgba(255,250,150,0.8),rgba(255,250,150,0.8) );background-repeat:no-repeat;background-size:100% 0.2em;background-position:0 88%;-webkit-transition:background-size 0.25s ease-in;transition:background-size 0.25s ease-in;}.css-157c1zx a:hover{background-size:100% 88%;}</style><div class="css-157c1zx e1v73u8h3"><p>We are on the process on converting our software architecture to <a href="https://microservices.io/">Microservices</a> and one way to communicate on each of these microservices is by using a message broker. So, a few weeks ago, we did an R&#x26;D about <a href="https://www.rabbitmq.com/">RabbitMQ</a>. Our goal was to understand what is RabbitMQ, how does it work, and finally figure out how can we implement RabbitMQ on our microservices. We’re moving to Microservices architecture to make our system more scalable, among other reasons. On our previous architecture, we’re using Redis as a message broker. <a href="https://redis.io/">Redis</a> is easy to set up, use and deploy but based on what I read, RabbitMQ is the way to go for more scalable software. Other than the scalability issues, Redis has these following problems as a <a href="https://en.wikipedia.org/wiki/Message_broker">message broker</a>:</p>
<ul>
<li>Does not support <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> by default. In Redis, securing messages and connection can be done by <a href="http://ecomputernotes.com/computernetworkingnotes/communication-networks/tunneling">tunneling strategies</a>. Redis recommend <a href="http://www.tarsnap.com/spiped.html">Spiped</a>.</li>
<li>Only support basic message queuing and routing.</li>
<li>High percentage of message loss when Redis, publisher or consumer crashes.</li>
<li>High latency in dealing with large messages. Redis is better suited for small messages.</li>
<li>Redis was built with different intention, in-memory key-value database, and not for being a message broker.</li>
</ul>
<p>We’re hoping that by implementing RabbitMQ on our Microservices architecture we could solved and prevent these problems.</p>
<h2>What is RabbitMQ</h2>
<p>RabbitMQ is a message broker that originally implements the <a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html">Advance Message Queuing Protocol (AMQP)</a>, but now it supports different messaging protocol via plugins. AMQP is an open standard for passing business messages between applications or organizations. AMQP standards was designed with the following main characteristics: Security, Reliability, Interoperability, Standard, Open. So how does RabbitMQ implement this characteristics:</p>
<ul>
<li>Security — support authentication, authorization, <a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol">LDAP</a>, and TLS via RabbitMQ plugins.</li>
<li>Reliability — <a href="https://www.rabbitmq.com/confirms.html">confirms</a> the message was successfully delivered to the message broker and confirms that the message was successfully processed by the consumer. RabbitMQ also have a builtin <a href="https://www.rabbitmq.com/clustering.html">clustering feature</a> that results to high availability, and scalability. There’s also an option to make your <a href="https://www.rabbitmq.com/persistence-conf.html">data persistent</a> so the message wont be lost in case the broker quits or crashes.</li>
<li>Interoperability — message is transfer as stream of bytes so any clients can operate on it. RabbitMQ supports a lot of <a href="https://www.rabbitmq.com/devtools.html">client libraries and and dev tools</a>, in different programming languages.</li>
<li>Open and Standard — aside from following the open standards of AMQP, <a href="https://github.com/rabbitmq">RabbitMQ is open source</a> and anyone can contribute to make it better.</li>
</ul>
<h2>RabbitMQ Architecture</h2>
<p><img src="../images/redis-implementation.png" alt="alt text" title="Redis Implimentation"></p>
<ol>
<li>An application publish a message to the message broker, which is in this case, Redis. The message was directly pushed to the queue.</li>
<li>The message is stored in a queue waiting to be consumed by a consumer from the same or different application.</li>
<li>A consumer consumes the message from the queue. The moment the message was consumed, it is deleted from the queue. Take note that on this part, the consumers was the one whose retrieving the message from the queue.</li>
<li>If the consumer fails to process the message, the consumer will push the message to the queue and the process will repeat from step 2.</li>
</ol>
<p>This process is very simple and straightforward but, it is fragile, not flexible, and hard to scale. It wont be able to handle these cases:</p>
<ul>
<li>How can I make sure the message was successfully published to the message broker?</li>
<li>What if Redis crashes? There’s a high possibility that the messages on route to the queue will be gone and there’s no available message broker to handle the incoming and outgoing messages.</li>
<li>What if the consumer crashes the time it consumed a message from the queue. The message will not be re-queued.</li>
<li>What if I want to publish the message to more than one queue or to the queues that met a set of criteria? For this to be possible, We need to manually modify our code base.</li>
</ul>
<p>Those cases above can be easily solved by RabbitMQ and its not that hard to implement. But first, lets see how RabbitMQ message broker works:</p>
<p><img src="../images/rabbitmq-implementation.png" alt="alt text" title="RabbitMQ Implimentation"></p>
<p>1 .The application publish a message to the message broker, in this case, RabbitMQ. The message was pushed to an Exchange instead of a queue.</p>
<ol start="2">
<li>The Exchange will route the message to the queue or queues that is bound to the Exchange.</li>
<li>The RabbitMQ message broker can notify the publisher if the message was successfully routed to the queue or queues and if it fails to route the message, the Exchange can notify the publisher that the message was unable to route. On this failed scenario, the publisher has an option to republish the message or not.</li>
<li>The message is stored in a queue waiting for an active consumer, if there are any active consumer, the message broker delivers the message from the queue to the active consumer.</li>
<li>A consumer consumes the message sent by the message broker from the queue. The consumer can automatically or manually send an acknowledgment to message broker that the message was successfully processed and the message can be safely remove from the queue.</li>
</ol>
<p>This is the high level approach and architecture of RabbitMQ message broker. Compared with Redis as message broker. RabbitMQ have an additional component, the Exchange that routes the message to the queue or queues. Also, RabbitMQ provides a mechanism that is essential to data safety. We can guarantee that the message was successfully routed to the queue or queues else we have an option to republish the message, and we can guarantee that the message was successfully processed by the consumer else we can re-queue the message so it can be consumed by other consumer. By understanding this approach and architecture we can conclude that RabbitMQ is not just simple but also a robust message broker.</p>
<h2>Code Examples</h2>
<p>These code examples is originally came from the RabbitMQ tutorial, I just did some modification so we can create a robust application using RabbitMQ. Also, these codes are written using <a href="https://pika.readthedocs.io/en/stable/">Python Pika RabbitMQ Client</a>. We will dissect this codes line by line to have better understanding how RabbitMQ works.</p>
<h3>Publisher Example</h3>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">import pika
import sys

connection = pika.BlockingConnection(pika.ConnectionParameters(&#39;localhost&#39;))
channel = connection.channel()

channel.exchange_declare(exchange=&#39;direct_exchange&#39;, exchange_type=&#39;direct&#39;)
channel.queue_declare(queue=&#39;direct_queue&#39;, durable=True)
channel.queue_bind(exchange=&#39;direct_exchange&#39;, queue=&quot;direct_queue&quot;, routing_key=&quot;direct.routing.key&quot;)

message = &quot; &quot;.join(sys.argv[1:]) or &quot;Hello World!&quot;

channel.confirm_delivery()
try:
    channel.basic_publish(exchange=&#39;direct_exchange&#39;, routing_key=&#39;direct.routing.key&#39;,
                          body=message, properties=pika.BasicProperties(delivery_mode=2)
                          )

    print(&quot;Sent %r&quot; % message)
except pika.exceptions.UnroutableError:
    print(&quot;Failed to send message %r&quot; % message)
connection.close()</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">connection = pika.BlockingConnection(pika.ConnectionParameters(‘localhost’)) </code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>After importing the required packages on line1–2. Line 4, We create a RabbitMQ connection instance, this connection uses <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol">TCP</a> as protocol. TCP protocol deals only with packets (bits of data) and enable the connection between two host so that they can exchange data. Also TCP guarantee that the message are delivered in order in which they were sent.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">channel = connection.channel()</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 5, we create a <a href="https://www.rabbitmq.com/channels.html">channel</a>, all the client operations happens on a channel. We can have more than one channel in one connection. The reason behind this is that: Some applications need multiple logical connections to the broker. However, it is undesirable to keep many TCP connections open at the same time because doing so consumes system resources and makes it more difficult to configure firewalls. So, channels can be thought of as "lightweight connections that share a single TCP connection".</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">channel.exchange_declare(exchange=’direct_exchange’,   exchange_type=’direct’)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 7, we create an <a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#exchanges">Exchange</a>. As what we’ve discussed earlier, The responsibility of the Exchange is to route the messages to the queue or queues. Exchange knows where to route the messages based on the specified routing key. We declare our Exchange with two parameters: exchange — the name of the exchange, and the <code class="language-text">exchange_type—</code> the type of the exchange controls how the message will be routed. There are four types of exchange:</p>
<ul>
<li><a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-default">direct exchange</a> — delivers messages to queues based on the message routing key.</li>
<li><a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-fanout">fanout exchange</a> — routes messages to all of the queues that are bound to it and the routing key is ignored.</li>
<li><a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-topic">topic exchanges</a> — route messages to one or many queues based on matching between a message routing key and the pattern that was used to bind a queue to an exchange. Routing keys follows this pattern <word>.<word>.<n-word>, and to find a match we use * (star) to substitute for exactly one word and # (hash) to substitute for zero or more words.</li>
<li><a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-headers">headers exchange</a> — is designed for routing on multiple attributes that are more easily expressed as message headers than a routing key.</li>
</ul>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">channel.queue_declare(queue=’direct_queue’, durable=True)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 8, We create a <a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#queues">queue</a> with <code class="language-text">queue</code> — the queue name and durable as parameter. When RabbitMQ quits or crashes it will forget the queues and messages unless you tell it not to. By setting our queue as durable, we can make sure that even if RabbitMQ quits or crashes, our queues wont be deleted.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">channel.queue_bind(exchange=&#39;direct_exchange&#39;, queue=&quot;direct_queue&quot;, routing_key=&quot;direct.routing.key&quot;)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 9, we <a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#bindings">bind</a> our queue to an exchange and specified the routing key. As a result, Exchange now knows where to route the messages based on the specified routing key and the type of the exchange.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">channel.confirm_delivery()</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 13, we enable <a href="https://www.rabbitmq.com/confirms.html#publisher-confirms">publish confirms</a>, by doing so the message broker will raise an error if it fails to route our messages to our queue or queues. Take note that by enabling publish confirms, it adds a little overhead as the message broker needs to confirm the message delivery to the publisher.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">try:
    channel.basic_publish(exchange=&#39;direct_exchange&#39;, routing_key=&#39;direct.routing.key&#39;,
                          body=message, properties=pika.BasicProperties(delivery_mode=2)
                          )

    print(&quot;Sent %r&quot; % message)
except pika.exceptions.UnroutableError:
    print(&quot;Failed to send message %r&quot; % message)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Line 14–21, we publish a message to the queue. Based on the parameters we tell the publisher to publish our message (body parameter) to an exchange named <code class="language-text">direct_exchange</code> with the routing key <code class="language-text">direct.routing.key</code> .These parameters are self explanatory except the properties parameter. With additional properties, we tell the publisher to deliver our message using <code class="language-text">delivery_mode=2</code> meaning we want to make our message persistent. Just like with queues, messages are non-persistent unless we told RabbitMQ to make it persistent. Non-persistent queues and messages will be deleted in case RabbitMQ quits or crashes, by making the queues and messages persistent we can make sure that the queues and message will survive in case RabbitMQ quits or crashes. and on line 20, we catch an exception when the message broker fails to route our message to the queue or queues. This gives us an option if we want to republish the message or drop it.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">connection.close()</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 22, we’re closing the connection. It is not a good practice to open and close connections and channels every time we publish a message. Connections are long lived and it takes resources to keep opening and closing them. I just include this line for the example purposes on how to close the connection.</p>
<h3>Consumer Example</h3>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">import pika
import time

connection = pika.BlockingConnection(pika.ConnectionParameters(&#39;localhost&#39;))
channel = connection.channel()

channel.exchange_declare(exchange=&#39;direct_exchange&#39;, exchange_type=&#39;direct&#39;)
channel.queue_declare(queue=&#39;direct_queue&#39;, durable=True)
channel.queue_bind(exchange=&#39;direct_exchange&#39;, queue=&quot;direct_queue&quot;, routing_key=&quot;direct.routing.key&quot;)


def callback(ch, method, properties, body):
        print(&quot;Received %r&quot; % body)
        time.sleep(body.count(b&#39;.&#39;))
        print(&quot;Done&quot;)
        ch.basic_ack(delivery_tag=method.delivery_tag)


channel.basic_qos(prefetch_count=1)
channel.basic_consume(callback, queue=&#39;direct_queue&#39;)

print(&#39;Waiting for messages. To exit press CTRL+C&#39;)
channel.start_consuming()</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">connection = pika.BlockingConnection(pika.ConnectionParameters(&#39;localhost&#39;))                       channel = connection.channel()</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 1–9 have the same explanation with the publisher app. For Line 4–5, Its understandable that we need to create a connection and channel so we can connect to the message broker.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">channel.exchange_declare(exchange=&#39;direct_exchange&#39;, exchange_type=&#39;direct&#39;)
channel.queue_declare(queue=&#39;direct_queue&#39;, durable=True)
channel.queue_bind(exchange=&#39;direct_exchange&#39;, queue=&quot;direct_queue&quot;, routing_key=&quot;direct.routing.key&quot;)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>But for line 7–9, it doesn't make sense, because we already created and configure the queue in the publisher app. The reason behind this redundancy is that we need to make sure that the queue exist or else RabbitMQ will just drop the message. So technically, declaring and configuring the queue on the publisher and consumer app is considered a good practice in RabbitMQ. Declaring a queue with the same name and properties is idempotent, meaning we can run it multiple times but only one queue will be created. But take note that if we create a queue with the same name with different properties, RabbitMQ will raise an error.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">def callback(ch, method, properties, body):
        print(&quot;Received %r&quot; % body)
        time.sleep(body.count(b&#39;.&#39;))
        print(&quot;Done&quot;)
        ch.basic_ack(delivery_tag=method.delivery_tag)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Line 12–16 is our callback function, meaning this will be triggered once we consume a message from the queue. This callback function requires four parameter the:</p>
<ul>
<li><code class="language-text">ch</code> — the channel instance.</li>
<li><code class="language-text">method</code> — include the details how the message is delivered (e.g <code class="language-text">routing_key</code> , <code class="language-text">exchange</code> , and <code class="language-text">delivery_tag</code> )</li>
<li><code class="language-text">properties</code> — the properties we set on the publisher (e.g <code class="language-text">delivery_mode</code> )</li>
<li><code class="language-text">body</code> — the message we consumed from the queue. it is in bytes datatype.</li>
</ul>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">ch.basic_ack(delivery_tag=method.delivery_tag)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 16, we <a href="https://www.rabbitmq.com/confirms.html">acknowledge</a> that the message was successfully processed by the consumer and it is now safe to delete it from the queue. By default, the acknowledgment happens automatically. This means that once the message was consumed by the consumer the message in the queue will be deleted even though the consumer is not done processing the message. This mode is often referred to as “fire-and-forget”. Unlike with manual acknowledgement model, if consumers’s TCP connection or channel is closed before successful delivery, the message sent by the server will be lost. Therefore, automatic message acknowledgement should be considered unsafe and not suitable for all workloads.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">channel.basic_qos(prefetch_count=1)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 19, we set the <a href="https://www.rabbitmq.com/consumer-prefetch.html">qos (Quality of Service)</a> with <code class="language-text">prefetch=1</code>, to make sure only one message will be consumed and the RabbitMQ wont push any message to the consumer until the current message was acknowledged. If we don’t set any qos <code class="language-text">prefetch</code> the consumer will accept as much number of messages it can handle and this can cause bottleneck as we can have as much number of inflight and unacknowledged messages on the consumer that supposedly can handle by another consumer instance.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">channel.basic_consume(callback, queue=&#39;direct_queue&#39;)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Line 20, we set the consumer to consume from the <code class="language-text">direct_queue</code> and to set our <code class="language-text">callback()</code> as consumer callback. So every time the consumer consumes a message from the queue this <code class="language-text">callback()</code> will be automatically triggered.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">channel.start_consuming()</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>And lastly, on Line 23, we trigger an infinite loop that waits for a message and trigger our <code class="language-text">callback()</code>.</p>
<p>Now by dissecting our code examples line by line, we have a better grasp and understanding on how RabbitMQ works and how we can implement this robust message broker on our applications whenever it is applicable.</p>
<p>Happy Coding!</p>
<h2>Resources</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=deG25y_r6OY">RabbitMQ in 5 minutes by Bernhard Wenzel Training</a></li>
<li><a href="https://www.youtube.com/watch?v=XjuiZM7JzPw">Reliable Messaging With RabbitMQ — Part 1 by JimOnDemand</a></li>
<li><a href="https://www.youtube.com/watch?v=Mjq8cLEVApE">RabbitMQ Exchange Types and its use cases with Examples by Tech WatchDog</a></li>
<li><a href="https://www.youtube.com/watch?v=aru59OmRNJ0">High availability and failover in RabbitMQ by Tech WatchDog</a></li>
<li><a href="https://www.linkedin.com/pulse/redis-vs-rabbitmq-message-broker-vishnu-kiran-k-v">Redis vs RabbitMq as a message broker by Vishnu Kiran K V</a></li>
<li><a href="https://www.amqp.org/about/what">AMQP is the Internet Protocol for Business Messaging</a></li>
<li><a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html">AMQP 0–9–1 Model Explained</a></li>
<li><a href="https://www.rabbitmq.com/confirms.html">Consumer Acknowledgements and Publisher Confirms</a></li>
<li><a href="https://www.rabbitmq.com/channels.html">RabbitMQ Channels</a></li>
<li><a href="https://www.rabbitmq.com/consumers.html">RabbitMQ Consumers</a></li>
<li><a href="https://www.rabbitmq.com/tutorials/tutorial-one-python.html">RabbitMQ Basic Python Tutorial</a></li>
<li><a href="https://www.rabbitmq.com/tutorials/tutorial-two-python.html">RabbitMQ Basic Python Tutorial — Work Queues</a></li>
<li><a href="https://www.rabbitmq.com/tutorials/tutorial-three-python.html">RabbitMQ Basic Python Tutorial — Publisher/Subscriber</a></li>
<li><a href="https://www.rabbitmq.com/tutorials/tutorial-four-python.html">RabbitMQ Basic Python Tutorial — Routing</a></li>
<li><a href="https://www.rabbitmq.com/tutorials/tutorial-five-python.html">RabbitMQ Basic Python Tutorial — Topics</a></li>
<li><a href="https://www.rabbitmq.com/devtools.html">RabbitMQ Libraries and Devtools</a></li>
</ul></div></div></main><style data-emotion-css="1l4w6pd">.css-1l4w6pd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><footer class="css-1l4w6pd e1ehxxwc2"><p>© <!-- -->2020<!-- -->, Built with<!-- --> </p><style data-emotion-css="o5uqvq">.css-o5uqvq{margin-left:5px;}</style><a href="https://www.gatsbyjs.org" class="css-o5uqvq e1ehxxwc1">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/software-engineering-journal/learning-rabbitmq";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-66cb945683d4e63ab9bd.js"],"component---src-pages-404-js":["/component---src-pages-404-js-cb727a5ad32918090050.js"],"component---src-pages-index-js":["/component---src-pages-index-js-c8f62ee36df539bdf03c.js"],"component---src-pages-software-engineering-journal-js":["/component---src-pages-software-engineering-journal-js-0b23c1639bda4e51f3aa.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-b8dd6c499f6a6988d5db.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-b8dd6c499f6a6988d5db.js" async=""></script><script src="/commons-4671f1335672facc668e.js" async=""></script><script src="/styles-befd5c688c712b9481d4.js" async=""></script><script src="/app-66cb945683d4e63ab9bd.js" async=""></script><script src="/framework-548c46c822ff9b8dc8b7.js" async=""></script><script src="/webpack-runtime-e2098a117b0273a4ae10.js" async=""></script></body></html>