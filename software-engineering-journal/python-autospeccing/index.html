<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.d48560e6ff0a9b23efe7.css">code[class*=language-],pre[class*=language-]{color:#c5c8c6;text-shadow:0 1px rgba(0,0,0,.3);font-family:Inconsolata,Monaco,Consolas,Courier New,Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#1d1f21}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#7c7c7c}.token.punctuation{color:#c5c8c6}.namespace{opacity:.7}.token.keyword,.token.property,.token.tag{color:#96cbfe}.token.class-name{color:#ffffb6;text-decoration:underline}.token.boolean,.token.constant{color:#9c9}.token.deleted,.token.symbol{color:#f92672}.token.number{color:#ff73fd}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a8ff60}.token.variable{color:#c6c5fe}.token.operator{color:#ededed}.token.entity{color:#ffffb6;cursor:help}.token.url{color:#96cbfe}.language-css .token.string,.style .token.string{color:#87c38a}.token.atrule,.token.attr-value{color:#f9ee98}.token.function{color:#dad085}.token.regex{color:#e9c062}.token.important{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:200;src:local("Nunito Extra Light "),local("Nunito-Extra Light"),url(/static/nunito-latin-200-2dbeb8d854e77c952cb636cb14a151c4.woff2) format("woff2"),url(/static/nunito-latin-200-e53a21a8bf1b97fb9900e8d5c5bfbc14.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:200;src:local("Nunito Extra Light italic"),local("Nunito-Extra Lightitalic"),url(/static/nunito-latin-200italic-bbdf1c37c56e1bfaf618b9a4ee46d508.woff2) format("woff2"),url(/static/nunito-latin-200italic-2bcb70df023a72cb0a5864c993d03bfc.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:300;src:local("Nunito Light "),local("Nunito-Light"),url(/static/nunito-latin-300-98aabf9aea1a55e2390109ad1efddce3.woff2) format("woff2"),url(/static/nunito-latin-300-97e0d2fc0422400a6e7be8f1b5e4949e.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:300;src:local("Nunito Light italic"),local("Nunito-Lightitalic"),url(/static/nunito-latin-300italic-ac71e7f9cd408dd512f6a6bbbd64eb51.woff2) format("woff2"),url(/static/nunito-latin-300italic-8646bd832f738c016b56b146af6fcd46.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:400;src:local("Nunito Regular "),local("Nunito-Regular"),url(/static/nunito-latin-400-508e414e3d3bc41666826fee46c7d881.woff2) format("woff2"),url(/static/nunito-latin-400-e5875b853d135f2a82ceae7ac537b6f4.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:400;src:local("Nunito Regular italic"),local("Nunito-Regularitalic"),url(/static/nunito-latin-400italic-28f555d9a5c83842f03988ed14f00ef5.woff2) format("woff2"),url(/static/nunito-latin-400italic-09ce3100c075ee04f293b9191c88f156.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:600;src:local("Nunito SemiBold "),local("Nunito-SemiBold"),url(/static/nunito-latin-600-8b8871e482a76d7e9327b02131564af7.woff2) format("woff2"),url(/static/nunito-latin-600-f894e279899f0cda9d06e32b78783399.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:600;src:local("Nunito SemiBold italic"),local("Nunito-SemiBolditalic"),url(/static/nunito-latin-600italic-9f930640316b0b9e8b088958d8f7aa5c.woff2) format("woff2"),url(/static/nunito-latin-600italic-9d150271cf30aefb8609dff4c9ece978.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:700;src:local("Nunito Bold "),local("Nunito-Bold"),url(/static/nunito-latin-700-a22acb48f45d03d672bf5b9389363a83.woff2) format("woff2"),url(/static/nunito-latin-700-7d90308f9bdf7321be5e28d017a5ade5.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:700;src:local("Nunito Bold italic"),local("Nunito-Bolditalic"),url(/static/nunito-latin-700italic-4507a1361620a66827e217855c9fff24.woff2) format("woff2"),url(/static/nunito-latin-700italic-26556875512fee1b823bc6117c076358.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:800;src:local("Nunito ExtraBold "),local("Nunito-ExtraBold"),url(/static/nunito-latin-800-eaa946756e91563b4b7d766de2f5b7ed.woff2) format("woff2"),url(/static/nunito-latin-800-5fa815a069b40c78f26863eaabcd6d2f.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:800;src:local("Nunito ExtraBold italic"),local("Nunito-ExtraBolditalic"),url(/static/nunito-latin-800italic-b9cd56a25c86d089cc18bc92dbad167a.woff2) format("woff2"),url(/static/nunito-latin-800italic-2e1a4979ec23066532d157ab5fe4ccc5.woff) format("woff")}@font-face{font-family:Nunito;font-style:normal;font-display:swap;font-weight:900;src:local("Nunito Black "),local("Nunito-Black"),url(/static/nunito-latin-900-f82c6fb49774f4e4caa570640e164320.woff2) format("woff2"),url(/static/nunito-latin-900-19de37363cebfe020de6d4abdbb38c2e.woff) format("woff")}@font-face{font-family:Nunito;font-style:italic;font-display:swap;font-weight:900;src:local("Nunito Black italic"),local("Nunito-Blackitalic"),url(/static/nunito-latin-900italic-6f10930c04eec040ac4ffb4890191149.woff2) format("woff2"),url(/static/nunito-latin-900italic-ca56cb53793f0f9084f26315012cefd8.woff) format("woff")}code{background-color:rgba(0,0,0,.04)}body{margin:0;font-family:Nunito,Avenir,Helvetica,"sans-serif";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{font-style:normal;color:rgba(0,0,0,.8);-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.8rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.8rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}a::selection,h1::selection,h2::selection,h3::selection,h4::selection,h5::selection,h6::selection,p::selection{background:rgba(255,250,150,.8)}.gatsby-highlight{background-color:#1d1f21;border-radius:.3em;margin:.5em 0;padding:1em;overflow:auto}.gatsby-highlight pre[class*=language-].line-numbers{padding:0 0 0 2.8em;overflow:initial}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 2.21.33"/><title data-react-helmet="true">Python Autospeccing | Ryan Ermita</title><meta data-react-helmet="true" name="description" content="While I’m looking for a way to test my function that has a pymysql query, I stumble upon a code snippet with this line. So I took my time to know how this stuff…"/><meta data-react-helmet="true" property="og:title" content="Python Autospeccing"/><meta data-react-helmet="true" property="og:description" content="While I’m looking for a way to test my function that has a pymysql query, I stumble upon a code snippet with this line. So I took my time to know how this stuff…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@ryanermita"/><meta data-react-helmet="true" name="twitter:title" content="Python Autospeccing"/><meta data-react-helmet="true" name="twitter:description" content="While I’m looking for a way to test my function that has a pymysql query, I stumble upon a code snippet with this line. So I took my time to know how this stuff…"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><link as="script" rel="preload" href="/webpack-runtime-e2098a117b0273a4ae10.js"/><link as="script" rel="preload" href="/framework-548c46c822ff9b8dc8b7.js"/><link as="script" rel="preload" href="/app-66cb945683d4e63ab9bd.js"/><link as="script" rel="preload" href="/styles-befd5c688c712b9481d4.js"/><link as="script" rel="preload" href="/commons-4671f1335672facc668e.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-b8dd6c499f6a6988d5db.js"/><link as="fetch" rel="preload" href="/page-data/software-engineering-journal/python-autospeccing/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1pyi7sa">.css-1pyi7sa{background:transparent;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><header class="css-1pyi7sa e2i1wbd3"><style data-emotion-css="k1grrt">.css-k1grrt{max-width:860px;padding:1rem 1.0875rem;font-size:1.2rem;}</style><div class="css-k1grrt e2i1wbd0"><p><style data-emotion-css="1kljdew">.css-1kljdew{color:black;margin-left:15px;-webkit-text-decoration:none;text-decoration:none;display:inline-block;position:relative;margin-left:0;}.css-1kljdew::after{content:"";position:absolute;width:100%;-webkit-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);height:2px;bottom:0;left:0;background-color:rgba(0,0,0,0.8);-webkit-transform-origin:bottom right;-ms-transform-origin:bottom right;transform-origin:bottom right;-webkit-transition:-webkit-transform 0.4s cubic-bezier(0.86,0,0.07,1);-webkit-transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);}.css-1kljdew:hover::after{-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:bottom left;-ms-transform-origin:bottom left;transform-origin:bottom left;}</style><a class="css-1kljdew e2i1wbd2" href="/">Ryan Ermita</a><style data-emotion-css="1wj6arw">.css-1wj6arw{color:black;margin-left:15px;-webkit-text-decoration:none;text-decoration:none;display:inline-block;position:relative;}.css-1wj6arw::after{content:"";position:absolute;width:100%;-webkit-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);height:2px;bottom:0;left:0;background-color:rgba(0,0,0,0.8);-webkit-transform-origin:bottom right;-ms-transform-origin:bottom right;transform-origin:bottom right;-webkit-transition:-webkit-transform 0.4s cubic-bezier(0.86,0,0.07,1);-webkit-transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);transition:transform 0.4s cubic-bezier(0.86,0,0.07,1);}.css-1wj6arw:hover::after{-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:bottom left;-ms-transform-origin:bottom left;transform-origin:bottom left;}</style><a class="css-1wj6arw e2i1wbd1" href="/software-engineering-journal">Software Engineering Journal</a></p></div></header><style data-emotion-css="1813l62">.css-1813l62{margin:0 auto;max-width:860px;padding:0 1.0875rem 1rem;padding-top:0;}</style><div class="css-1813l62 e1ehxxwc0"><main><style data-emotion-css="hu0znc">.css-hu0znc{margin:0 auto;max-width:860px;padding:1.45rem 1.0875rem;}</style><div class="css-hu0znc e1v73u8h0"><style data-emotion-css="1q2z4uj">.css-1q2z4uj{display:inline;border-radius:1em 0 1em 0;}</style><h1 class="css-1q2z4uj e1v73u8h1">Python Autospeccing</h1><style data-emotion-css="wvcn4j">.css-wvcn4j{margin-top:10px;color:#606060;}</style><h3 class="css-wvcn4j e1v73u8h2">February 03 , 2019<!-- --> - <!-- -->4 min read</h3><style data-emotion-css="157c1zx">.css-157c1zx a{-webkit-text-decoration:none;text-decoration:none;position:relative;background-image:linear-gradient( rgba(255,250,150,0.8),rgba(255,250,150,0.8) );background-repeat:no-repeat;background-size:100% 0.2em;background-position:0 88%;-webkit-transition:background-size 0.25s ease-in;transition:background-size 0.25s ease-in;}.css-157c1zx a:hover{background-size:100% 88%;}</style><div class="css-157c1zx e1v73u8h3"><p>While I’m looking for a way to test my function that has a pymysql query, I stumble upon a code snippet with this line.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">@mock.patch(&#39;simple.pymysql&#39;, autospec=True)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>So I took my time to know how this stuff works. Apparently Python has a very good documentation about it.</p>
<h2>What’s <code class="language-text">autospec=True</code> for?</h2>
<p>  If you set <code class="language-text">autospec=True</code> then the mock will be created with a spec from the object being replaced. All attributes of the mock will also have the spec of the corresponding attribute of the object being replaced. Methods and functions being mocked will have their arguments checked and will raise a <code class="language-text">TypeError</code> if they are called with the wrong signature. — <a href="https://docs.python.org/3.5/library/unittest.mock.html#patch">Python Patch documentation</a></p>
<p>To make it short, <code class="language-text">autospec=True</code> creates a mock object with the spec of the object being mocked. It is <code class="language-text">False</code> by default. You can also create a autospecced Mock object using <code class="language-text">create_autospec(spec)</code>.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">import unittest
from unittest.mock import patch

class MyDummyClass:

    def test_dummy_function(self):
        return &quot;hello&quot;


class TestAutoSpec(unittest.TestCase):

    @patch(&#39;test_func.MyDummyClass&#39;, autospec=True)
    def test_autospec_true(self, mock_dummy_class):
        print(dir(mock_dummy_class))
        pass

    @patch(&#39;test_func.MyDummyClass&#39;)
    def test_autospec_false(self, mock_dummy_class):
        print(dir(mock_dummy_class))
        pass</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The sample test script above will have this output below.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">python -m unittest test_func.py -v
test_autospec_false (test_func.TestAutoSpec) ... [&#39;assert_any_call&#39;, &#39;assert_called&#39;, &#39;assert_called_once&#39;, &#39;assert_called_once_with&#39;, &#39;assert_called_with&#39;, &#39;assert_has_calls&#39;, &#39;assert_not_called&#39;, &#39;attach_mock&#39;, &#39;call_args&#39;, &#39;call_args_list&#39;, &#39;call_count&#39;, &#39;called&#39;, &#39;configure_mock&#39;, &#39;method_calls&#39;, &#39;mock_add_spec&#39;, &#39;mock_calls&#39;, &#39;reset_mock&#39;, &#39;return_value&#39;, &#39;side_effect&#39;]
ok
test_autospec_true (test_func.TestAutoSpec) ... [&#39;__class__&#39;, &#39;__delattr__&#39;, &#39;__dict__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__getattribute__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__init__&#39;, &#39;__init_subclass__&#39;, &#39;__le__&#39;, &#39;__lt__&#39;, &#39;__module__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__setattr__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;, &#39;__weakref__&#39;, &#39;assert_any_call&#39;, &#39;assert_called&#39;, &#39;assert_called_once&#39;, &#39;assert_called_once_with&#39;, &#39;assert_called_with&#39;, &#39;assert_has_calls&#39;, &#39;assert_not_called&#39;, &#39;attach_mock&#39;, &#39;call_args&#39;, &#39;call_args_list&#39;, &#39;call_count&#39;, &#39;called&#39;, &#39;configure_mock&#39;, &#39;method_calls&#39;, &#39;mock_add_spec&#39;, &#39;mock_calls&#39;, &#39;reset_mock&#39;, &#39;return_value&#39;, &#39;side_effect&#39;, &#39;test_dummy_function&#39;]
ok</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>As you can notice with the result, the test method with <code class="language-text">autospec=True</code> has additional <code class="language-text">test_dummy_function</code> and <a href="https://dbader.org/blog/python-dunder-methods">dunder/magic methods</a>. Those additional functions are part of the spec of <code class="language-text">MyDummyClass</code>.</p>
<h2>Why does autospeccing exist?</h2>
<p>Based on the Python documentation autospeccing solves these two flaws of Mocking objects.</p>
<ul>
<li><strong>Because mocks auto-create attributes on demand</strong>, and allow you to call them with arbitrary arguments, if you misspell one of these assert methods then your assertion is gone.</li>
<li>The second issue is more general to mocking. If you refactor some of your code, rename members and so on, <strong>any tests for code that is still using the old API but uses mocks instead of the real objects will still pass</strong>. This means your tests can all pass even though your code is broken.</li>
</ul>
<p>If Mocking have those flaws and autospeccing solves it. Why not just create Mock objects with <code class="language-text">autospec=True</code> by default instead of <code class="language-text">False</code>? The reason behind this is also written in Python Documentation:</p>
<p>  This isn’t without caveats and limitations however, which is why it is not the default behaviour. In order to know what attributes are available on the spec object, autospec has to introspect (access attributes) the spec. As you traverse attributes on the mock a corresponding traversal of the original object is happening under the hood. If any of your specced objects have properties or descriptors that can trigger code execution then you may not be able to use autospec. On the other hand it is much better to design your objects so that introspection is safe.</p>
<p>  A more serious problem is that it is common for instance attributes to be created in the <a href="https://docs.python.org/3.5/reference/datamodel.html#object.__init__"><code class="language-text">__init__()</code></a> method and not to exist on the class at all. <strong>autospec can’t know about any dynamically created attributes and restricts the API to visible attributes.</strong></p>
<p>This is a simple code snippet that demonstrate the quoted caveat above.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">import unittest
from unittest.mock import patch


class MyDummyClass:

    def __init__(self):
        self.my_dummy_attribute = &quot;yey!&quot;

    def test_dummy_function(self):
        return &quot;hello&quot;


class TestAutoSpec(unittest.TestCase):

    @patch(&#39;test_func.MyDummyClass&#39;, autospec=True)
    def test_autospec_function(self, mock_dummy_class):
        self.assertTrue(hasattr(mock_dummy_class, &quot;test_dummy_function&quot;))

    @patch(&#39;test_func.MyDummyClass&#39;, autospec=True)
    def test_autospec_attribute(self, mock_dummy_class):
        self.assertTrue(hasattr(mock_dummy_class, &quot;test_dummy_attribute&quot;))</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The snippet above will result to this:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">python -m unittest test_func.py -v
test_autospec_attribute (test_func.TestAutoSpec) ... FAIL
test_autospec_function (test_func.TestAutoSpec) ... ok
======================================================================
FAIL: test_autospec_attribute (test_func.TestAutoSpec)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/usr/local/Cellar/python/3.6.5/Frameworks/Python.framework/Versions/3.6/lib/python3.6/unittest/mock.py&quot;, line 1179, in patched
    return func(*args, **keywargs)
  File &quot;/Users/ryan/Workspace/playground/test_func.py&quot;, line 22, in test_autospec_attribute
    self.assertTrue(hasattr(mock_dummy_class, &quot;test_dummy_attribute&quot;))
AssertionError: False is not true

----------------------------------------------------------------------
Ran 2 tests in 0.010s
FAILED (failures=1)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The <code class="language-text">test_autospec_attribute</code> failed because the mocked object doesn’t know about the <code class="language-text">test_dummy_attribute</code> which is dynamically created in the <code class="language-text">__init__()</code>.</p>
<h2>Conclusion</h2>
<p>Autospeccing is a great tool for testing. It minimize the errors caused by misspelling of the methods and making sure our mocked objects are updated based on the changes of the original object which is a great help for refactoring.</p>
<p>But like any other tools, don't overuse it. Understanding the tools and knowing the applicable use of those tools are utmost important.</p>
<p>Happy testing!</p>
<h2>Resources</h2>
<ul>
<li><a href="https://docs.python.org/3.5/library/unittest.mock.html#autospeccing">Python Documentation: Autospeccing</a></li>
<li><a href="https://docs.python.org/3.5/library/unittest.mock.html#unittest.mock.create_autospec">Python Documentation: create_autospec</a></li>
<li><a href="https://stackoverflow.com/questions/35915703/when-using-unittest-mock-patch-why-is-autospec-not-true-by-default">When using unittest.mock.patch, why is autospec not True by default?</a></li>
<li><a href="https://dbader.org/blog/python-dunder-methods">Enriching Your Python Classes With Dunder (Magic, Special) Methods</a></li>
</ul></div></div></main><style data-emotion-css="1l4w6pd">.css-1l4w6pd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><footer class="css-1l4w6pd e1ehxxwc2"><p>© <!-- -->2020<!-- -->, Built with<!-- --> </p><style data-emotion-css="o5uqvq">.css-o5uqvq{margin-left:5px;}</style><a href="https://www.gatsbyjs.org" class="css-o5uqvq e1ehxxwc1">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/software-engineering-journal/python-autospeccing";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-66cb945683d4e63ab9bd.js"],"component---src-pages-404-js":["/component---src-pages-404-js-cb727a5ad32918090050.js"],"component---src-pages-index-js":["/component---src-pages-index-js-c8f62ee36df539bdf03c.js"],"component---src-pages-software-engineering-journal-js":["/component---src-pages-software-engineering-journal-js-0b23c1639bda4e51f3aa.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-b8dd6c499f6a6988d5db.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-b8dd6c499f6a6988d5db.js" async=""></script><script src="/commons-4671f1335672facc668e.js" async=""></script><script src="/styles-befd5c688c712b9481d4.js" async=""></script><script src="/app-66cb945683d4e63ab9bd.js" async=""></script><script src="/framework-548c46c822ff9b8dc8b7.js" async=""></script><script src="/webpack-runtime-e2098a117b0273a4ae10.js" async=""></script></body></html>