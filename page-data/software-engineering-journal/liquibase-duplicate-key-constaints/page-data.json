{"componentChunkName":"component---src-templates-blog-post-js","path":"/software-engineering-journal/liquibase-duplicate-key-constaints","result":{"data":{"markdownRemark":{"html":"<p>During the production deployment of one of our services, we encountered a database error when running our liquibase migration. Additional details, the service that we’re trying to deploy already have an initial set of data. The error we encountered is this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">ERROR:  duplicate key violates unique constraint</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This error happens because liquibase assumes that we’re migrating a fresh set of data, so it starts the primary key sequence at 1. <a href=\"https://stackoverflow.com/a/21639138\">This can be solved by setting the primary key sequence at the right location</a>. Which can be done by running this query on your database console.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> setval<span class=\"token punctuation\">(</span><span class=\"token string\">'primary_id_seq'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">MAX</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> <span class=\"token keyword\">table</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This will set the primary key sequence to the next sequence which will prevent the error that we encountered. Ideally, when migrating with Liquibase on a services that has initial data, we should include the update query of the primary key sequence on our migration script.</p>","excerpt":"During the production deployment of one of our services, we encountered a database error when running our liquibase migration. Additional details, the service…","frontmatter":{"date":"April 21 , 2020","path":"/software-engineering-journal/liquibase-duplicate-key-constaints","title":"Liquibase Duplicate Key Constraints"},"fields":{"readingTime":{"text":"1 min read"}}}},"pageContext":{}}}