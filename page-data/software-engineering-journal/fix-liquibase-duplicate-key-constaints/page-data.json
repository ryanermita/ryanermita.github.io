{"componentChunkName":"component---src-templates-blog-post-js","path":"/software-engineering-journal/fix-liquibase-duplicate-key-constaints","result":{"data":{"markdownRemark":{"html":"<p>During the production deployment of one of our services, we encountered a database error when running our <a href=\"https://www.liquibase.org/\">liquibase</a> migration. As additional information, the service that we’re trying to deploy already have an initial set of data. The error we encountered is this:</p>\n<pre><code class=\"language-bash\">ERROR:  duplicate key violates unique constraint\n</code></pre>\n<p>This error happens because liquibase assumes that we’re migrating a fresh set of data, so it starts the primary key sequence at 1. <a href=\"https://stackoverflow.com/a/21639138\">This can be solved by setting the primary key sequence at the right location</a>. Which can be done by running this query on your database console.</p>\n<pre><code class=\"language-sql\">SELECT setval('primary_id_seq', (SELECT MAX(id) FROM table)+1);\n</code></pre>\n<p>This will set the primary key sequence to the next sequence which will prevent the error that we encountered. Ideally, when migrating with <a href=\"https://www.liquibase.org/\">Liquibase</a> on a services that has initial data, we should include the update key sequence query on our migration script.</p>","excerpt":"During the production deployment of one of our services, we encountered a database error when running our liquibase migration. As additional information, the…","frontmatter":{"date":"April 21 , 2020","path":"/software-engineering-journal/fix-liquibase-duplicate-key-constaints","title":"Fix Liquibase Duplicate Key Constraints"},"fields":{"readingTime":{"text":"1 min read"}}}},"pageContext":{}}}